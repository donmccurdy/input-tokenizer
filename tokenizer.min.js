/*! input-tokenizer 2016-04-23 */
!function(a){"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery"),window):a(jQuery,window)}(function(a,b,c){var d="tokenizer",e=function(d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a({}),z=a.extend({xContent:"&times;",namespace:"tknz",label:"Tags:",placeholder:"",separators:[","," ","."],callback:null,source:null,allowUnknownTags:!0,numToSuggest:5,onclick:null,allowDuplicates:!1},e);return j=function(){f=d,k(),l()},k=function(){var b=z.namespace;g=a('<div class="'+b+'-list"></div>'),z.placeholder&&f.attr("placeholder",z.placeholder),i=a('<div class="'+b+'-suggest"><ul></ul></div>'),h=f.addClass(b+"-input").wrap('<span class="'+b+'-input-wrapper"></span>').parent().wrap('<div class="'+b+'-wrapper"></div>').parent().prepend(g).prepend('<span class="'+b+'-wrapper-label">'+z.label+"</span>").find("."+b+"-input-wrapper").append(i).end()},l=function(){var c=z.namespace;h.on("focus","input",function(){h.addClass(c+"-focus")}).on("blur","input",function(){h.removeClass(c+"-focus"),y.delay(200).queue().push(function(){z.source?t([],""):v(f.val()),a.dequeue(this)})}).on("keydown","input",function(a){if(a=a||b.event,a.which=a.which||a.keyCode||a.charCode,8===a.which&&!f.val())return n(),void s();var d=c+"-sel",e=i.find("."+d);38===a.which?(a.preventDefault(),e.length?e.removeClass(d).prev("li").add(e.siblings().last()).eq(0).addClass(d):i.find("li").last().addClass(d)):40===a.which&&(a.preventDefault(),e.length?e.removeClass(d).next("li").addClass(d):i.find("li").first().addClass(d))}).on("keypress","input",function(a){(z.separators.indexOf(String.fromCharCode(a.which))>-1||13===a.which)&&(a.preventDefault(),v(f.val()))}).on("keyup","input",function(c){c=c||b.event,c.which=c.which||c.keyCode||c.charCode,38!==c.which&&40!==c.which&&(a.isArray(z.source)?t(z.source):z.source&&z.source(f.val(),t))}).on("click",function(){f.focus()}).on("click","."+c+"-token-x",function(b){b.stopPropagation(),a(this).closest("."+c+"-token").remove(),s()}).on("mousedown","."+c+"-suggest-li",function(b){b.preventDefault(),f.val(""),m(a(this).text()),t([]),s()}).on("click","."+c+"-token",function(b){z.onclick&&(b.stopPropagation(),z.onclick(a(this).children("."+c+"-token-label").text()))})},v=function(a){var b=u();a&&(z.allowUnknownTags||b)&&(m(b||a),f.val(""),s()),t([],"")},m=function(a){var b=x(a);if(z.allowDuplicates||b){var c=z.namespace,d=c+"-token",e='<div class="'+d+'" data-token="'+a+'"><span class="'+d+'-label">'+a.trim()+'</span><span class="'+d+'-x">'+z.xContent+"</span></div>";g.append(e)}return f},n=function(){return g.children().last().detach().data("token")||null},o=function(b){var c=g.children().filter(function(){return a(this).data("token")==b}).detach();return c.length>0?1===c.length?c.data("token"):c.length:null},q=function(){return g.empty(),f},p=function(){var a,b=[],c=g.children();for(a=0;a<c.length;a++)b.push(c.eq(a).data("token").toString());return b},r=function(){return h.after(f).remove(),z.placeholder&&f.attr("placeholder",""),f.removeClass(z.namespace+"-input")},s=function(){return(z.callback||a.noop)(f),f},t=function(a,b){b=b===c?f.val():b;var d,e=z.namespace,g=new RegExp(w(b),"i"),h=new RegExp("^"+w(b)+"$","i"),j=z.numToSuggest||1e3,k=[];for(d=0;b&&d<a.length&&k.length<j;d++)a[d].match(g)&&(z.allowDuplicates||x(a[d],d))&&k.push('<li class="'+e+"-suggest-li"+(a[d].match(h)?" "+e+"-sel":"")+'">'+a[d]+"</li>");i.children("ul").html(k.join("")).end()[k.length?"addClass":"removeClass"]("."+e+"-vis")},u=function(){return i.find("."+z.namespace+"-sel").eq(0).text()},w=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},x=function(a){return-1===p().indexOf(a)},j(d),{push:m,pop:n,remove:o,empty:q,get:p,destroy:r,callback:s}},f={init:function(a){return"INPUT"!==this[0].nodeName?(console.error('Tokenizer requires an <input type="text"> tag.'),this):this.data(d,e(this,a))},push:function(a){return this.data(d).push(a)},pop:function(){return this.data(d).pop()},remove:function(a){return this.data(d).remove(a)},empty:function(){return this.data(d).empty()},get:function(){return this.data(d).get()},destroy:function(){return this.data(d).destroy()},callback:function(){return this.data(d).callback()}};return a.fn[d]=function(a){return f[a]?(this.data(d)||console.error('Cannot call "'+a+'" - Tokenizer not initialized.'),f[a].apply(this,Array.prototype.slice.call(arguments,1))):"object"!=typeof a&&a?void console.error("Unknown tokenizer method "+a+"."):f.init.apply(this,arguments)},a.fn[d]});